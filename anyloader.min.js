!function(e,n){"function"==typeof define&&define.amd?define("anyloader",["jquery","underscore"],n):"undefined"!=typeof exports?n(require("jquery"),require("underscore")):e.LoaderFactory=n(e.jQuery||e.Zepto||e.ender||e.$,e._)}(this,function(e,n){var t="[name],[id],[data-name]",r=/[{}<>\[\]]/,o=/^(?:(https?:\/\/.*)|(?:ur[li]\(\s*'([^']*)'\s*\))|(?:ur[li]\(\s*"([^"]*)"\s*\))|(?:ur[li]\(\s*([^)]*)\s*\)))/,u=function(t){return t instanceof e.Deferred||n.isFunction(t.then)};return function(a,c){n.isObject(a)||(a={});var p=function(){var t=n.compact(n.map(n.toArray(arguments),function(e){return null==e?null:(e=p.parse.apply(p.context,[e]),null==e?null:p.compose.apply(p.context,[e]))}));return n.isEmpty(t)&&t.push(null),e.when.apply(p.context,t)};return p.defaults={"parse:string":function(e){return n.isString(e)?e:null},"parse:json":function(n){try{return e.parseJSON(n.replace(/[\n\r\t]/g,""))}catch(t){return null}},"parse:html":function(n){try{n=e(n);var r=n.filter(t);return r.length>0?r:n}catch(o){return null}},"parse:uri":function(n){var t=e.Deferred(),r=n.match(o);return null==r?null:(r=r[1]||r[2]||r[3]||r[4],e.ajax({url:r}).done(function(e,r){"success"==r?p.apply(p.context,[e]).done(function(e){t.resolve(e)}).fail(function(){t.resolve(n)}):t.resolve(n)}).fail(function(){t.resolve(n)}),t)},"parse:jquery":function(t){var r={},o=[];return t.each(function(){var n=e(this),t=n.attr("name")||n.attr("id")||n.data("name"),u=e.trim(n.html());t?r[t]=u:o.push(u)}),n.isEmpty(r)?o:r},"parse:array":function(e){return e},"parse:object":function(e){return e},parse:function(t){if(null==t)return null;if(n.isString(t))if(r.test(t))t=p["parse:json"].apply(p.context,[t])||p["parse:html"].apply(p.context,[t]);else if(t=p["parse:uri"].apply(p.context,[t])||p["parse:string"].apply(p.context,[t]),u(t))return t;return null==t?null:(t instanceof e&&(t=p["parse:jquery"].apply(p.context,[t])),null==t?null:(n.isArray(t)&&(t=p["parse:array"].apply(p.context,[t])),n.isObject(t)&&(t=p["parse:object"].apply(p.context,[t])),t))},"compose:deferred":function(e){return e},"compose:string":function(e){return e},"compose:array":function(t){if(!n.isFunction(p["compose:array[]"]))return t;var r=e.Deferred();return e.when.apply(p.context,n.map(t,function(e){return p["compose:array[]"].apply(p.context,[e])})).done(function(){r.resolve(n.toArray(arguments))}),r},"compose:object[]":function(e,t){var r=p["compose:object["+e+"]"];return n.isFunction(r)?[e,r.apply(p.context,[t])]:[e,t]},"compose:object":function(t){if(n.isFunction(p["compose:object[]"])){var r=e.Deferred();return t=n.object(n.map(n.pairs(t),function(e){return p["compose:object[]"].apply(p.context,e)})),e.when.apply(p.context,n.values(t)).done(function(){r.resolve(n.object(n.keys(t),arguments))}),r}return t},compose:function(e){return n.isString(e)?p["compose:string"].apply(p.context,[e]):u(e)?p["compose:deferred"].apply(p.context,[e]):n.isArray(e)?p["compose:array"].apply(p.context,[e]):n.isObject(e)?p["compose:object"].apply(p.context,[e]):e}},n.extend(p,p.defaults,a),p.context=c||p,p}});