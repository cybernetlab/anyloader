!function(e,n){"function"==typeof define&&define.amd?define("anyloader",["jquery","underscore"],n):"undefined"!=typeof exports?n(require("jquery"),require("underscore")):e.LoaderFactory=n(e.jQuery||e.Zepto||e.ender||e.$,e._)}(this,function(e,n){var t="[name],[id],[data-name]",r=/[{}<>\[\]]/,o=/^(?:(https?:\/\/.*)|(?:url\(\s*'([^']*)'\s*\))|(?:url\(\s*"([^"]*)"\s*\))|(?:url\(\s*([^)]*)\s*\)))/,a=function(t){return t instanceof e.Deferred||n.isFunction(t.then)};return function(u,c){n.isObject(u)||(u={});var s=function(){var t=n.compact(n.map(n.toArray(arguments),function(e){return null==e?null:(e=s.parse.apply(s.context,[e]),null==e?null:s.compose.apply(s.context,[e]))}));return n.isEmpty(t)&&t.push(null),e.when.apply(s.context,t)};return s.defaults={"parse:string":function(e){return n.isString(e)?e:null},"parse:json":function(n){try{return e.parseJSON(n.replace(/[\n\r\t]/g,""))}catch(t){return null}},"parse:html":function(n){try{n=e(n);var r=n.filter(t);return r.length>0?r:n}catch(o){return null}},"parse:uri":function(t){var r=e.Deferred(),u=t.match(o);return null==u?null:(u=u[1]||u[2]||u[3]||u[4],e.ajax({url:u}).done(function(e,o){if("success"==o)if(n.isObject(e)||n.isString(e)){var u=s.parse.apply(s.context,[e]);a(u)?u.done(function(e){r.resolve(e)}):r.resolve(u)}else r.resolve(t);else r.resolve(t)}).fail(function(){r.resolve(t)}),r)},"parse:jquery":function(t){var r={},o=[];return t.each(function(){var n=e(this),t=n.attr("name")||n.attr("id")||n.data("name"),a=e.trim(n.html());t?r[t]=a:o.push(a)}),n.isEmpty(r)?o:r},"parse:array":function(e){return e},"parse:object":function(e){return e},parse:function(t){if(null==t)return null;if(n.isString(t))if(r.test(t))t=s["parse:json"].apply(s.context,[t])||s["parse:html"].apply(s.context,[t]);else if(t=s["parse:uri"].apply(s.context,[t])||s["parse:string"].apply(s.context,[t]),a(t))return t;return null==t?null:(t instanceof e&&(t=s["parse:jquery"].apply(s.context,[t])),null==t?null:(n.isArray(t)&&(t=s["parse:array"].apply(s.context,[t])),n.isObject(t)&&(t=s["parse:object"].apply(s.context,[t])),t))},"compose:deferred":function(e){return e},"compose:string":function(e){return e},"compose:array":function(t){if(!n.isFunction(s["compose:array[]"]))return t;var r=e.Deferred();return e.when.apply(s.context,n.map(t,function(e){return s["compose:array[]"].apply(s.context,[e])})).done(function(){r.resolve(n.toArray(arguments))}),r},"compose:object[]":function(e,t){var r=s["compose:object["+e+"]"];return n.isFunction(r)?[e,r.apply(s.context,[t])]:[e,t]},"compose:object":function(t){if(n.isFunction(s["compose:object[]"])){var r=e.Deferred();return t=n.object(n.map(n.pairs(t),function(e){return s["compose:object[]"].apply(s.context,e)})),e.when.apply(s.context,n.values(t)).done(function(){r.resolve(n.object(n.keys(t),arguments))}),r}return t},compose:function(e){return n.isString(e)?s["compose:string"].apply(s.context,[e]):a(e)?s["compose:deferred"].apply(s.context,[e]):n.isArray(e)?s["compose:array"].apply(s.context,[e]):n.isObject(e)?s["compose:object"].apply(s.context,[e]):e}},n.extend(s,s.defaults,u),s.context=c||s,s}});