!function(e,r){"function"==typeof define&&define.amd?define("anyloader",["jquery","underscore"],r):"undefined"!=typeof exports?r(require("jquery"),require("underscore")):e.LoaderFactory=r(e.jQuery||e.Zepto||e.ender||e.$,e._)}(this,function(e,r){var n="[name],[id],[data-name]",t=/[{}<>\[\]]/,a=/^(?:(https?:\/\/.*)|(?:url\(\s*'([^']*)'\s*\))|(?:url\(\s*"([^"]*)"\s*\))|(?:url\(\s*([^)]*)\s*\)))/,u=function(n){return n instanceof e.Deferred||r.isFunction(n.then)};return function(i,s){r.isObject(i)||(i={});var c=function(){var n=[];return r.each(r.toArray(arguments),function(t){if(null!=t&&(t=c.parse.apply(c.context,[t]),null!=t)){if(!u(t)){if(r.isArray(t)&&r.isFunction(c["create:element"])){var a=e.Deferred();return e.when.apply(c.context,r.map(t,c["create:element"],c.context)).done(function(){var e=r.toArray(arguments);r.isFunction(c.create)&&(e=c.create.apply(c.context,[e])),a.resolve(e)}),void n.push(a)}if(r.isObject(t)){var i=r.filter(r.keys(t),function(e){return r.isFunction(c["create:"+e])});if(i.length>0){var a=e.Deferred(),s=r.map(i,function(e){return c["create:"+e].apply(c.context,[t[e]])});return e.when.apply(c.context,s).done(function(){r.extend(t,r.object(i,r.toArray(arguments))),r.isFunction(c.create)&&(t=c.create.apply(c.context,[t])),a.resolve(t)}),void n.push(a)}}if(r.isFunction(c.create)&&(t=c.create.apply(c.context,[t]),null==t))return}n.push(t)}}),r.isEmpty(n)&&n.push(null),e.when.apply(c.context,n)};return c.parsers={"parse:string":function(e){return r.isString(e)?e:null},"parse:json":function(r){try{return e.parseJSON(r.replace(/[\n\r\t]/g,""))}catch(n){return null}},"parse:html":function(r){try{r=e(r);var t=r.filter(n);return t.length>0?t:r}catch(a){return null}},"parse:uri":function(n){var t=e.Deferred(),i=n.match(a);return null==i?null:(i=i[1]||i[2]||i[3]||i[4],e.ajax({url:i}).done(function(e,a){if("success"==a)if(r.isObject(e)||r.isString(e)){var i=c.parse.apply(c.context,[e]);u(i)?i.done(function(e){t.resolve(e)}):t.resolve(i)}else t.resolve(n);else t.resolve(n)}).fail(function(){t.resolve(n)}),t)},"parse:jquery":function(n){var t={},a=[];return n.each(function(){var r=e(this),n=r.attr("name")||r.attr("id")||r.data("name"),u=e.trim(r.html());n?t[n]=u:a.push(u)}),r.isEmpty(t)?a:t},"parse:array":function(e){return e},"parse:object":function(e){return e},parse:function(n){if(null==n)return null;if(r.isString(n))if(t.test(n))n=c["parse:json"].apply(c.context,[n])||c["parse:html"].apply(c.context,[n]);else if(n=c["parse:uri"].apply(c.context,[n])||c["parse:string"].apply(c.context,[n]),u(n))return n;return null==n?null:(n instanceof e&&(n=c["parse:jquery"].apply(c.context,[n])),null==n?null:(r.isArray(n)&&(n=c["parse:array"].apply(c.context,[n])),r.isObject(n)&&(n=c["parse:object"].apply(c.context,[n])),n))}},r.extend(c,c.parsers,i),c.context=s||c,c}});